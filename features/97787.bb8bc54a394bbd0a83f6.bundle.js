(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[97787],{81668:function(e,t,n){"use strict";n.d(t,{q:function(){return a},Z:function(){return b}});var a,i=n(92137),r=n(6610),s=n(5991),o=n(87757),u=n.n(o),c=(n(41539),n(88674),n(39714),n(71578)),d=n(91264),l=n(20555),h=n(40175),p=n(76232),m=n(57432),y=n(10898),f=n(45364),w=n(3571),v=n(65732),_=n(86805),k=n(32004),g=n(10648);!function(e){e.Withdraw="withdraw",e.Deposit="deposit"}(a||(a={}));var b=function(){function e(t){var n=this;(0,r.Z)(this,e),this._scope=t,this._predefinedDeposits=[50,100,500],this._minimumDepositLimit=this._predefinedDeposits[0],this._minWithdrawalFeeLimit=100,this._minWithdrawalFee=20,this._maxWithdrawalFee=150,this._progressiveFeeValue=.02,this.config={payment_endpoint:"/api/payment/perform_payment",payout_endpoint:"/api/payment/perform_payout"},this._validatePassword=(0,i.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.B.hasValidPassword()?Promise.resolve():p.B.validatePassword(n._userPassword));case 1:case"end":return e.stop()}}),e)}))),this.setPassword=function(e){n._userPassword=e,n._scope.applyAsync()},this.setCard=function(e){n._chosenCard=e,n._scope.applyAsync()},this.setDeposit=function(e){n._settings.mode===a.Withdraw&&(n._tokenBalanceAdapter.isLoaded()&&n._tokenBalanceAdapter.data().TokenCount<e&&(e=n._tokenBalanceAdapter.data().TokenCount),n.setWithdrawalFee(n.calculateWithdrawalFee(e))),n._settings.depositAmount=e,n._scope.applyAsync()},this.savePersonalInformation=function(e){return n._saveInformationKyc(e)},this.performTokenOrder=function(){var e=(0,i.Z)(u().mark((function e(t){var i,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n._submissionUnderway=!0,n._scope.applyAsync(),i={tokens:n._settings.depositAmount,currency:m.N.defaultCurrency(),holderName:n._chosenCard.PayerName,creditCard:null,EncryptedData:null,PaypalBillingAgreementId:n._chosenCard.Id,ExternalId:null,TargetTokenBalanceOwner:t.toString()},r=n.config.payment_endpoint,n._settings.mode===a.Withdraw&&(r=n.config.payout_endpoint),e.prev=5,e.next=8,n._validatePassword();case 8:return e.next=10,l.Z.to(r).body(i).timeout(3e4).call();case 10:"string"===typeof(s=e.sent)&&v.i.isGuid(s)?(n._transactionId=s,n.trackPurchase()):n._cmError=s;case 12:return e.prev=12,n._submissionUnderway=!1,n._scope.applyAsync(),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[5,,12,16]])})));return function(t){return e.apply(this,arguments)}}(),this.finish=function(e){n._submissionUnderway||(n._reset(0),e())},this._settings={},this._paypalBaAdapter=new h.Q(t),this._paypalBaAdapter.addDataCallback((function(e){(0,c.tQ)(e.BillingAgreements)||n.setCard(e.BillingAgreements[0])})),this._paypalBaAdapter.initByOwnUserId(d.JS.ViewModels.PaypalBillingAgreementCollectionViewModel.namespace),this._settings.fees={deposit:0,withdraw:this._minWithdrawalFee}}return(0,s.Z)(e,[{key:"payPalBALoaded",value:function(){return this._paypalBaAdapter.isLoaded()}},{key:"paypalBillingAgreements",value:function(){return this._paypalBaAdapter.isLoaded()?this._paypalBaAdapter.data().BillingAgreements:[]}},{key:"init",value:function(e,t,n){this._reset(t,n),this._tokenBalanceAdapter=new h.Q(this._scope).initByUrn(new _.Urn("token_balance",e)),this._paymentWithdrawalLimitAdapter=new h.Q(this._scope).initByOwnUserId("withdrawal_limit")}},{key:"_reset",value:function(e,t){this._userPassword="",this._settings.depositAmount=e,this._chosenCard=void 0,this._settings.mode=t,this._submissionUnderway=!1}},{key:"getFee",value:function(){return this._settings.fees[this._settings.mode]}},{key:"settings",value:function(){return this._settings}},{key:"predefinedDeposits",value:function(){return this._predefinedDeposits}},{key:"calculateWithdrawalFee",value:function(e){return e<=this._minWithdrawalFeeLimit?this._minWithdrawalFee:Math.min(this._maxWithdrawalFee,e*this._progressiveFeeValue+this._minWithdrawalFee)}},{key:"transactionId",value:function(){return this._transactionId}},{key:"cmError",value:function(){return this._cmError}},{key:"userPassword",value:function(){return this._userPassword}},{key:"submissionUnderway",value:function(){return this._submissionUnderway}},{key:"chosenCard",value:function(){return this._chosenCard}},{key:"setDepositFee",value:function(e){this._settings.fees.deposit=e}},{key:"setWithdrawalFee",value:function(e){this._settings.fees.withdraw=e}},{key:"netBillingAmount",value:function(){var e=this._settings.depositAmount;return this._settings.mode===a.Deposit?e+=this._settings.fees.deposit:this._settings.mode===a.Withdraw&&(e-=this._settings.fees.withdraw),e}},{key:"canAdvanceDepositChoice",value:function(){if(!y.cmOwnUser.hasPassword())return!1;switch(this._settings.mode){case a.Deposit:return this.isValidDeposit();case a.Withdraw:return!(this.hasCreditBalance()&&this.hasWithdrawalLimit()&&this.upperLimit()<this._settings.depositAmount)&&this.isValidWithdrawal();default:return}}},{key:"isValidDeposit",value:function(){return this._settings.depositAmount>=Math.max(0,this.minDepositLimit(),this._settings.fees.deposit)}},{key:"isValidWithdrawal",value:function(){return this._settings.depositAmount>=Math.max(0,this.minWithdrawal(),this._settings.fees.withdraw)}},{key:"hasCreditBalance",value:function(){return this._tokenBalanceAdapter.isLoaded()}},{key:"creditBalance",value:function(){var e;return null===(e=this._tokenBalanceAdapter.data())||void 0===e?void 0:e.TokenCount}},{key:"minWithdrawal",value:function(){var e,t;return null!==(e=null===(t=this._paymentWithdrawalLimitAdapter.data())||void 0===t?void 0:t.MinimumWithdrawalLimit)&&void 0!==e?e:0}},{key:"minDepositLimit",value:function(){return this._minimumDepositLimit}},{key:"hasWithdrawalLimit",value:function(){return this._paymentWithdrawalLimitAdapter.isLoaded()}},{key:"withdrawalLimit",value:function(){return this.hasWithdrawalLimit()?this._paymentWithdrawalLimitAdapter.data().WithdrawalLimit:0}},{key:"upperLimit",value:function(){return Math.min(this.withdrawalLimit(),this.creditBalance())}},{key:"newUserBlockedValue",value:function(){var e,t;return null===(e=null===(t=this._paymentWithdrawalLimitAdapter.data())||void 0===t?void 0:t.NewUserBlocked)||void 0===e||e}},{key:"_saveInformationKyc",value:function(){var e=(0,i.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.cmOwnUser.saveInformation(t);case 2:return n=e.sent,e.next=5,y.cmOwnUser.checkKyc();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"canAdvanceCreditCardChoice",value:function(){return-1!==this.paypalBillingAgreements().indexOf(this._chosenCard)}},{key:"trackPurchase",value:function(){var e=this._transactionId,t=m.N.tokensToCurrency(this._settings.depositAmount,m.N.defaultCurrency()),n=m.N.currencyName(m.N.defaultCurrency());f.K.trackPurchase({order_id:e,value:t,currency:n,content_name:this._settings.mode,content_type:"Wallet Transaction"}),w.O.trackPurchase({event_category:g.P.ChallengermodeWallet,event_action:"Purchase",transaction_id:e,affiliation:g.P.ChallengermodeWallet,value:t,currency:n}),k.Y.trackCompletePayment({content_category:g.P.ChallengermodeWallet,content_type:g.P.ChallengermodeWallet,content_name:this._settings.mode,content_id:e,value:t,price:t,currency:n})}}]),e}()},97787:function(e,t,n){"use strict";n.d(t,{SY:function(){return a},dR:function(){return P},Fe:function(){return A}});var a,i=n(92137),r=n(6610),s=n(5991),o=n(87757),u=n.n(o),c=(n(66992),n(41539),n(88674),n(78783),n(33948),n(39743)),d=n(24384),l=n(84694),h=n(11131),p=n(79075),m=n(81668),y=n(3571),f=n(45364),w=n(57432),v=n(91264),_=n(69747),k=n(46532),g=n(20555),b=n(10648),C=n(32004);!function(e){e[e.PayPal=0]="PayPal",e[e.Visa=1]="Visa",e[e.MasterCard=2]="MasterCard"}(a||(a={}));var P=new(function(){function e(){(0,r.Z)(this,e),this.paymentMethodBrandData=function(e){switch(e){case a.PayPal:return{title:"PayPal",logo:n(7544),background:"#0070ba"};case a.Visa:return{title:"Visa",logo:n(2538),background:"#006eb6"};case a.MasterCard:return{title:"MasterCard",logo:n(79895),background:"#b7b8bd"};default:return null}}}return(0,s.Z)(e,[{key:"spawnModal",value:function(e){c.tE.open({id:c.qq.Payment,component:Promise.all([n.e(64749),n.e(22013),n.e(84992),n.e(71752),n.e(84814),n.e(80241)]).then(n.bind(n,19967)),params:e,ignoreBackdrop:!0}),d.J.trackEvent({category:b.P.ChallengermodeWallet,name:"Open modal",label:this.paymentModeTitle(e.mode)})}},{key:"spawnCheckoutModal",value:function(e){if(_._.isAuthenticated()){c.tE.open({id:c.qq.Payment_Checkout,component:n.e(27959).then(n.bind(n,27959)),params:e});var t=w.N.tokensToCurrency(e.summary.totalTokenCount,v.CY.Currency.EUR),a=w.N.currencyName(v.CY.Currency.EUR);y.O.trackBeginCheckout({value:t,currency:a,items:[{id:e.summary.entityId,name:e.summary.details,quantity:1,price:t}]}),f.K.trackInitiateCheckout({value:t,currency:a,content_name:e.summary.details,content_ids:[e.summary.entityId],num_items:1}),C.Y.trackInitiateCheckout({value:t,currency:a,content_name:e.summary.details,content_ids:[e.summary.entityId],num_items:1})}else k.cmAccount.spawnLogInOrRegisterModal()}},{key:"paymentModeName",value:function(e){switch(e){case m.q.Deposit:return"deposit";case m.q.Withdraw:return"withdraw";default:return null}}},{key:"paymentModeTitle",value:function(e){return(0,l.zT)(this.paymentModeName(e))}},{key:"isPaymentsDisabled",value:function(){return!1}},{key:"disabledTitle",value:function(){return this.isPaymentsDisabled()?"Currently Unavailable":void 0}},{key:"disabledDescription",value:function(){return this.isPaymentsDisabled()?"Transactions will be reactivated again as soon as possible. Please contact support if you have any questions!":void 0}},{key:"isDepositsDisabled",value:function(){return this.isPaymentsDisabled()||!1}},{key:"depositsDisabledTooltip",value:function(){return this.isDepositsDisabled()?"Deposits are temporarily unavailable due to maintenance.":void 0}},{key:"isWithdrawalsDisabled",value:function(){return this.isPaymentsDisabled()||!1}},{key:"withdrawalsDisabledTooltip",value:function(){return this.isWithdrawalsDisabled()?"Withdrawals are temporarily unavailable due to maintenance.":void 0}},{key:"daysSinceJoined",value:function(e){return(0,p.rz)(new Date,p.Z8.utcServerToLocal(e),"days")}},{key:"daysLeftNewUserUnblock",value:function(e){return this.newUserDaysLimit()-this.daysSinceJoined(e)}},{key:"isNewUser",value:function(e,t){return e&&this.daysLeftNewUserUnblock(t)>0}},{key:"newUserDaysLimit",value:function(){return v.JS.ViewModels.WithdrawalLimitViewModel.NewUserDaysLimit}},{key:"downloadTransactionReceipt",value:function(){var e=(0,i.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.Z.to("/api/payment/receipts/".concat(t)).blob().method("GET").call();case 2:n=e.sent,(0,l.MF)(n,"receipt-".concat(t,".pdf"),"pdf");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}());function A(e,t,n){return(0,h.Oe)("You have insufficient funds. Please deposit\n        ".concat(w.N.moneyString({tokenCount:e-t.tokenCount,currency:n,currencySign:!0})," and try again.")),P.spawnModal({mode:m.q.Deposit,tokenBalanceId:t.tokenBalanceId,targetTokenBalanceOwner:t.urn,amount:e-t.tokenCount,startStep:1})}},76232:function(e,t,n){"use strict";n.d(t,{B:function(){return y}});n(12419);var a=n(92137),i=n(6610),r=n(5991),s=n(10379),o=n(46070),u=n(77608),c=n(87757),d=n.n(c),l=n(20555),h=n(70410),p=n(79075);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,o.Z)(this,n)}}var y=new(function(e){(0,s.Z)(n,e);var t=m(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).validatePassword=function(){var t=(0,a.Z)(d().mark((function t(n){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.Z.to("/extraauth/validate").body({password:n}).call();case 2:e._validatedPasswordAt=new Date,h.cmApiTicketVendor.clear(),h.cmApiTicketVendor.getTicket(),e.subject().next();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return(0,r.Z)(n,[{key:"hasValidPassword",value:function(){return!!this._validatedPasswordAt&&(0,p.Y_)(new Date,(0,p.cb)(this._validatedPasswordAt,{minutes:1}))}}]),n}(n(9123).b))},79895:function(e,t,n){e.exports=n.p+"Content/img/payment/da0a67df9fbed5e42934dc5d3c0403ec.svg"},7544:function(e,t,n){e.exports=n.p+"Content/img/payment/d86b6db74c015e1b6500fff2ec26dd18.svg"},2538:function(e,t,n){e.exports=n.p+"Content/img/payment/8c415c1d857cf820d2d745bc6740aa61.svg"}}]);